{% import 'utils.j2' as utils %}

{% extends "base.html" %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='weekly_report.css') }}">
<div class="main-container">
  <div class="container">
    <div class="content__inner">
      <h1>Еженедельный отчет по проекту</h1>
        <div class="space">
          {% for cat, msg in get_flashed_messages(True) %}
            <div class="space flash {{cat}}">{{msg}}</div>
          {% endfor %}

          {% for field, errors in form.errors.items() %}
            <div class="alert alert-error">
              {{ ', '.join(errors) }}
            </div>
          {% endfor %}

        <form method="POST" action="{{ url_for('report.weekly') }}">
          {{ form.csrf_token }}
          <p> {{form.project_name()}} </p>
          <p> {{form.submit()}} </p>
        </form>

      </div>

      <hr>
      {% if report %}
        <table>
        <caption>{{ caption }} </caption>
          
          <thead>
            <tr>
              <th>Статьи расходов</th>
              <th>За неделю,<br> чел/д</th>
              <th>Факт,<br> чел/д</th>
              <th>План,<br> чел/д</th>
              <th>Разница,<br> чел/д</th>
              <th>Прогресс,<br> %</th>
            </tr>
          </thead>

          <tbody>
            {% for cc_name in report %}
              <tr>
                <td style="text-align: left;">{{cc_name}}</td>
                <td>{{report[cc_name]["week_labor"]}}</td>
                <td>{{report[cc_name]["fact_labor"]}}</td>
                <td>{{report[cc_name]["plan_labor"]}}</td>
                <td>{{report[cc_name]["delta"]}}</td>
                <td>{{report[cc_name]["progress"]}}</td>
              </tr>
            {% endfor %}
          </tbody>

          <tfoot>
            <tr>
              <td style="text-align: left;">Итого:</td>
              <td>{{summury["week_labor"]}}</td>
              <td>{{summury["fact_labor"]}}</td>
              <td>{{summury["plan_labor"]}}</td>
              <td>{{summury["delta"]}}</td>
              <td>{{summury["progress"]}}</td>
            </tr>
          </tfoot>

        </table>
      {% endif %}
    </div>
  </div>
</div> 
{% endblock content %}